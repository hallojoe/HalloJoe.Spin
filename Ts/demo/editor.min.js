(function(n,t){typeof define=="function"&&define.amd?define(["jquery"],function(i){return n.returnExportsGlobal=t(i)}):typeof exports=="object"?module.exports=t(require("jquery")):t(jQuery)})(this,function(n){"use strict";var f,e,h,o,c,r,t,u,i,l,s;l="caret";f=function(){function r(n){this.$inputor=n;this.domInputor=this.$inputor[0]}return r.prototype.setPos=function(n){var e,u,r,f;return(f=i.getSelection())&&(r=0,u=!1,(e=function(n,i){var o,c,s,a,l,h;for(l=i.childNodes,h=[],s=0,a=l.length;s<a;s++){if(o=l[s],u)break;if(o.nodeType===3)if(r+o.length>=n){u=!0;c=t.createRange();c.setStart(o,n-r);f.removeAllRanges();f.addRange(c);break}else h.push(r+=o.length);else h.push(e(n,o))}return h})(n,this.domInputor)),this.domInputor},r.prototype.getIEPosition=function(){return this.getPosition()},r.prototype.getPosition=function(){var t,n;return n=this.getOffset(),t=this.$inputor.offset(),n.left-=t.left,n.top-=t.top,n},r.prototype.getOldIEPos=function(){var n,i;return i=t.selection.createRange(),n=t.body.createTextRange(),n.moveToElementText(this.domInputor),n.setEndPoint("EndToEnd",i),n.text.length},r.prototype.getPos=function(){var n,r,i;return(i=this.range())?(n=i.cloneRange(),n.selectNodeContents(this.domInputor),n.setEnd(i.endContainer,i.endOffset),r=n.toString().length,n.detach(),r):t.selection?this.getOldIEPos():void 0},r.prototype.getOldIEOffset=function(){var i,n;return i=t.selection.createRange().duplicate(),i.moveStart("character",-1),n=i.getBoundingClientRect(),{height:n.bottom-n.top,left:n.left,top:n.top}},r.prototype.getOffset=function(){var r,u,f,e,o;return i.getSelection&&(f=this.range())?(f.endOffset-1>0&&f.endContainer!==this.domInputor&&(r=f.cloneRange(),r.setStart(f.endContainer,f.endOffset-1),r.setEnd(f.endContainer,f.endOffset),e=r.getBoundingClientRect(),u={height:e.height,left:e.left+e.width,top:e.top},r.detach()),u&&(u!=null?u.height:void 0)!==0||(r=f.cloneRange(),o=n(t.createTextNode("|")),r.insertNode(o[0]),r.selectNode(o[0]),e=r.getBoundingClientRect(),u={height:e.height,left:e.left,top:e.top},o.remove(),r.detach())):t.selection&&(u=this.getOldIEOffset()),u&&(u.top+=n(i).scrollTop(),u.left+=n(i).scrollLeft()),u},r.prototype.range=function(){var n;if(i.getSelection)return n=i.getSelection(),n.rangeCount>0?n.getRangeAt(0):null},r}();e=function(){function r(n){this.$inputor=n;this.domInputor=this.$inputor[0]}return r.prototype.getIEPos=function(){var u,n,f,o,e,i,r;return n=this.domInputor,i=t.selection.createRange(),e=0,i&&i.parentElement()===n&&(o=n.value.replace(/\r\n/g,"\n"),f=o.length,r=n.createTextRange(),r.moveToBookmark(i.getBookmark()),u=n.createTextRange(),u.collapse(!1),e=r.compareEndPoints("StartToEnd",u)>-1?f:-r.moveStart("character",-f)),e},r.prototype.getPos=function(){return t.selection?this.getIEPos():this.domInputor.selectionStart},r.prototype.setPos=function(n){var i,r;return i=this.domInputor,t.selection?(r=i.createTextRange(),r.move("character",n),r.select()):i.setSelectionRange&&i.setSelectionRange(n,n),i},r.prototype.getIEOffset=function(n){var i,t,r,u;return t=this.domInputor.createTextRange(),n||(n=this.getPos()),t.move("character",n),r=t.boundingLeft,u=t.boundingTop,i=t.boundingHeight,{left:r,top:u,height:i}},r.prototype.getOffset=function(r){var f,u,e;return f=this.$inputor,t.selection?(u=this.getIEOffset(r),u.top+=n(i).scrollTop()+f.scrollTop(),u.left+=n(i).scrollLeft()+f.scrollLeft(),u):(u=f.offset(),e=this.getPosition(r),{left:u.left+e.left-f.scrollLeft(),top:u.top+e.top-f.scrollTop(),height:e.height})},r.prototype.getPosition=function(n){var t,u,r,i,f,e;return t=this.$inputor,r=function(n){return n=n.replace(/<|>|`|"|&/g,"?").replace(/\r\n|\r|\n/g,"<br/>"),/firefox/i.test(navigator.userAgent)&&(n=n.replace(/\s/g,"&nbsp;")),n},n===void 0&&(n=this.getPos()),e=t.val().slice(0,n),u=t.val().slice(n),i="<span style='position: relative; display: inline;'>"+r(e)+"<\/span>",i+="<span id='caret' style='position: relative; display: inline;'>|<\/span>",i+="<span style='position: relative; display: inline;'>"+r(u)+"<\/span>",f=new h(t),f.create(i).rect()},r.prototype.getIEPosition=function(n){var r,i,t,u,f;return t=this.getIEOffset(n),i=this.$inputor.offset(),u=t.left-i.left,f=t.top-i.top,r=t.height,{left:u,top:f,height:r}},r}();h=function(){function t(n){this.$inputor=n}return t.prototype.css_attr=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopStyle","borderRightStyle","borderBottomStyle","borderLeftStyle","borderTopWidth","boxSizing","fontFamily","fontSize","fontWeight","height","letterSpacing","lineHeight","marginBottom","marginLeft","marginRight","marginTop","outlineWidth","overflow","overflowX","overflowY","paddingBottom","paddingLeft","paddingRight","paddingTop","textAlign","textOverflow","textTransform","whiteSpace","wordBreak","wordWrap"],t.prototype.mirrorCss=function(){var t,i=this;return t={position:"absolute",left:-9999,top:0,zIndex:-2e4},this.$inputor.prop("tagName")==="TEXTAREA"&&this.css_attr.push("width"),n.each(this.css_attr,function(n,r){return t[r]=i.$inputor.css(r)}),t},t.prototype.create=function(t){return this.$mirror=n("<div><\/div>"),this.$mirror.css(this.mirrorCss()),this.$mirror.html(t),this.$inputor.after(this.$mirror),this},t.prototype.rect=function(){var n,t,i;return n=this.$mirror.find("#caret"),t=n.position(),i={left:t.left,top:t.top,height:n.height()},this.$mirror.remove(),i},t}();o={contentEditable:function(n){return!!(n[0].contentEditable&&n[0].contentEditable==="true")}};r={pos:function(n){return n||n===0?this.setPos(n):this.getPos()},position:function(n){return t.selection?this.getIEPosition(n):this.getPosition(n)},offset:function(n){return this.getOffset(n)}};t=null;i=null;u=null;s=function(n){var r;return(r=n!=null?n.iframe:void 0)?(u=r,i=r.contentWindow,t=r.contentDocument||i.document):(u=void 0,i=window,t=document)};c=function(n){var r;t=n[0].ownerDocument;i=t.defaultView||t.parentWindow;try{return u=i.frameElement}catch(f){r=f}};n.fn.caret=function(t,i,u){var h;return r[t]?(n.isPlainObject(i)?(s(i),i=void 0):s(u),h=o.contentEditable(this)?new f(this):new e(this),r[t].apply(h,[i])):n.error("Method "+t+" does not exist on jQuery.caret")};n.fn.caret.EditableCaret=f;n.fn.caret.InputCaret=e;n.fn.caret.Utils=o;n.fn.caret.apis=r});$.fn.selectRange=function(n,t){return typeof t=="undefined"&&(t=n),this.each(function(){if("selectionStart"in this)this.selectionStart=n,this.selectionEnd=t;else if(this.setSelectionRange)this.setSelectionRange(n,t);else if(this.createTextRange){var i=this.createTextRange();i.collapse(!0);i.moveEnd("character",t);i.moveStart("character",n);i.select()}})};String.prototype.toHtml=function(){var n=this;return n=n.replace(/\n/g,"<\/p><p>"),n="<p>"+n+"<\/p>",n.replace("<p><\/p>","")};$(function(){function y(n,i){if(i!==null){$(t).val(n);var f=i.toString(),u=f.split(c),h=u.shift(),l=u.join(c).toHtml(),a=i.countMinWords(),y=i.countMaxWords();$(v).html(h);$(r).html(l);$(e).text(i.countVariants());$(o).text(a);$(s).text(y);$(r).unmark().mark("iPhonen")}}function l(i){var u=i.substr(0,12)==="Unexpected }"||i.substr(0,13)==="{ at position";if(u){var h=i.split(" "),l=h.length===5?4:3,c=Number(h[l]),u=c!==NaN;u&&(n.success=!u,n.message=i,n.caret=c);$(r).html(i||"-");$(e).text("-");$(o).text("-");$(s).text("-")}else n.success=!0,n.message="";n.success?$(f).removeClass("in"):($(f).html(n.message).addClass("in"),$(t).selectRange(n.caret,n.caret+1))}function u(n,t){var i;try{i=new SpinTexter.TextSpinner(n,new SpinTexter.ParserConfig(!t?-1:t));y(n,i);l("")}catch(r){l(r)}}var a=[16,17,18,19,20,27,33,34,35,36,37,38,39,40],t="#spintext-input",f="#spintext-error",v="#spintext-title",r="#spintext-result",e="#spintext-variants",o="#spintext-min-words",s="#spintext-max-words",h="#spintext-input-caret-position",c="\n",i=null,n={loading:!0,success:!0,message:"",caret:0};$.get("spintext.txt",function(r){u(r);$(document).on("click",".process-spin",function(){u($(t).val())}).on("keyup",t,function(r){if(key=window.event?event.keyCode:r.keyCode,a.indexOf(key)===-1){var f=$(this);i!=null&&clearTimeout(i);i=setTimeout(function(){i=null;u(f.val())},300)}n.caret=$(t).caret("pos");$(h).text(n.caret)}).on("mousedown mouseup",t,function(){n.caret=$(t).caret("pos");$(h).text(n.caret)}).on("change paste cut",t,function(){$(this).height(0).height(this.scrollHeight)});$(t).change()});$('[data-toggle="tooltip"]').tooltip()});